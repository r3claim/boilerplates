#Kernel Hardening
/etc/sysctl.d/99-hardening.conf
# Netzwerk-Härtung
net.ipv4.conf.all.rp_filter = 1        # Verhindert IP-Spoofing
net.ipv4.conf.all.log_martians = 1     #Logging 
net.ipv4.conf.default.log_martians = 1  #Logging
net.ipv4.conf.default.rp_filter = 1
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.tcp_syncookies = 1            # SYN-Flood Schutz
net.ipv4.tcp_max_syn_backlog = 4096

# Kernel-Selbstschutz
kernel.kptr_restrict = 2               # Versteckt Kernel-Symbole
kernel.dmesg_restrict = 1              # Restriktion des Kernel-Logs
kernel.yama.ptrace_scope = 1           # Einschränkung von Process Tracing
fs.protected_hardlinks = 1
fs.protected_symlinks = 1

# IPv6 deaktivieren (falls intern nicht genutzt, reduziert Angriffsfläche massiv)
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1

---

/etc/ssh/sshd_config
# ---------------------------------------------------------------------
# SSHD Hardening Configuration - Debian 12 Bookworm
# Compliance: BSI TR-02102-4 (2025) & CIS Debian 12 Benchmark v1.1.0
# ---------------------------------------------------------------------

# -- Netzwerk & Ports --
Port 22                         # Ändern empfohlen (z.B. 2222), um Log-Spam zu reduzieren (Security by Obscurity)
AddressFamily inet              # IPv6 deaktiviert (analog zu Ihren sysctl-Settings)
ListenAddress 0.0.0.0
Protocol 2

# -- Host Keys & Zertifikate (BSI TR-02102-4) --
# Entfernt Unterstützung für schwache Algorithmen wie ECDSA (NIST-Kurven) oder RSA < 3000 Bit
HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_rsa_key

# -- Kryptographie-Richtlinien (BSI "Bedingt geeignet" bis 2029+) --
# Key Exchange: Nur Perfect Forward Secrecy (PFS), keine NIST-Kurven, DH >= 3000 Bit
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512

# Ciphers: Authenticated Encryption (AEAD) bevorzugt
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com

# MACs: Nur Encrypt-then-MAC (EtM), falls AEAD nicht greift
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com

# HostKey Algorithmen: Keine SHA-1 Signaturen erlaubt
HostKeyAlgorithms ssh-ed25519,rsa-sha2-512,rsa-sha2-256

# -- Authentifizierung (CIS 5.2) --
PermitRootLogin no              # Kritisch: Kein direkter Root-Login
PubkeyAuthentication yes        # Nur Key-Based Auth
PasswordAuthentication no       # Keine Passwörter
PermitEmptyPasswords no
ChallengeResponseAuthentication no
KerberosAuthentication no
GSSAPIAuthentication no
HostbasedAuthentication no
IgnoreRhosts yes

# -- Session & Prozess-Härtung --
UsePAM yes                      # Notwendig für session limits, aber Auth läuft über Keys
AuthenticationMethods publickey # Erzwingt Public Key, ignoriert PAM-Auth-Module
LoginGraceTime 60               # Zeitfenster für Login drastisch verkürzt
MaxAuthTries 3                  # Schutz gegen Brute-Force
MaxStartups 10:30:100           # Drosselung bei DDoS auf den SSH-Port

# -- Timeout & KeepAlive (CIS 5.2.13) --
# Beendet inaktive Sitzungen nach 5 Minuten (300 Sekunden)
ClientAliveInterval 300
ClientAliveCountMax 0

# -- Feature Minimierung (BSI SYS.1.3) --
X11Forwarding no                # Keine GUI-Übertragung
AllowAgentForwarding no         # Verhindert Übernahme des lokalen Agenten
AllowTcpForwarding no           # Verhindert Nutzung als Tunnel/Proxy
PermitTunnel no
PermitUserEnvironment no        # Verhindert Manipulation von Umgebungsvariablen
PrintMotd no                    # Weniger Info-Leakage
Banner /etc/issue.net           # Rechtlicher Warnhinweis (CIS Forderung)

# -- Logging --
SyslogFacility AUTH
LogLevel VERBOSE                # Verbose loggt den Fingerprint des Keys beim Login (Forensik)